<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hospital Leave Management System</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
/* Global Styles */
*{box-sizing:border-box;margin:0;padding:0;font-family: 'Roboto', sans-serif;}
body{background:#f0f4f8;color:#333;}
header{background:#0062cc;color:white;padding:15px 30px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 6px rgba(0,0,0,0.1);}
header img{height:50px;}
nav ul{list-style:none;display:flex;gap:25px;}
nav ul li{cursor:pointer;font-weight:500;transition:0.3s;}
nav ul li:hover{color:#ffd700;}
.hero{background:url('https://images.unsplash.com/photo-1588776814546-f90211d5d7b6?auto=format&fit=crop&w=1350&q=80') center/cover no-repeat;height:200px;display:flex;align-items:center;justify-content:center;color:white;font-size:2em;font-weight:bold;text-shadow:2px 2px 6px rgba(0,0,0,0.6);}
.container{padding:25px;max-width:1200px;margin:auto;}

/* Cards */
.cards{display:flex;flex-wrap:wrap;gap:20px;margin-bottom:25px;}
.card{background:white;padding:20px;flex:1 1 22%;text-align:center;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);transition:transform 0.3s, box-shadow 0.3s;}
.card:hover{transform:translateY(-5px);box-shadow:0 8px 20px rgba(0,0,0,0.15);}
.card h4{margin-bottom:10px;color:#0062cc;display:flex;align-items:center;justify-content:center;gap:8px;font-weight:600;}
.card p{font-size:1.5em;font-weight:700;}

/* Forms */
input,select,textarea,button{width:100%;margin:8px 0;padding:12px;border-radius:8px;border:1px solid #ccc;font-size:1em;}
input:focus,select:focus,textarea:focus{outline:none;border:2px solid #0062cc;}
textarea{resize:none;}
button{cursor:pointer;color:white;border:none;transition:0.3s;font-weight:600;}
.apply-btn{background:#0062cc;}
.apply-btn:hover{background:#004a99;}
.approve{background:green;}
.approve:hover{background:#006600;}
.reject{background:red;}
.reject:hover{background:#990000;}
.logout{background:#444;}
.logout:hover{background:#222;}

/* Tables */
table{width:100%;border-collapse:collapse;margin-top:15px;background:white;border-radius:8px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.05);}
th,td{padding:12px;text-align:center;border-bottom:1px solid #e0e0e0;}
th{background:#0062cc;color:white;font-weight:500;}
tr:hover{background:#f1f7ff;}
.filter-group{display:flex;gap:15px;margin-bottom:15px;flex-wrap:wrap;}

/* Sections */
.section{display:none;}
.section.active{display:block;}

/* Login Box */
.login-box{max-width:400px;background:white;padding:25px;margin:auto;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.1);}
.login-box h3{margin-bottom:20px;text-align:center;color:#0062cc;}

/* Footer */
footer{background:#0062cc;color:white;padding:20px;text-align:center;margin-top:30px;border-top:2px solid #004a99;}

/* Responsive */
@media(max-width:1024px){.cards{flex-direction:row;flex-wrap:wrap;} }
@media(max-width:768px){.cards{flex-direction:column;}nav ul{flex-direction:column;gap:10px;}header{flex-direction:column;align-items:flex-start;gap:10px;} }
</style>
</head>
<body>

<header>
    <div style="display:flex;align-items:center;gap:15px;">
        <img src="https://masterbundles.com/wp-content/uploads/2023/11/11-477-1024x1024.jpg" alt="Hospital Logo">
        <h2>City Hospital Leave Portal</h2>
    </div>
    <nav>
        <ul>
            <li onclick="showSection('dashboard')"><i class="fa-solid fa-gauge-high"></i> Dashboard</li>
            <li onclick="showSection('apply')"><i class="fa-solid fa-file-circle-plus"></i> Apply Leave</li>
            <li onclick="showSection('history')"><i class="fa-solid fa-user-clock"></i> My Leaves</li>
            <li onclick="checkManagerAccess()"><i class="fa-solid fa-user-shield"></i> HR / Manager</li>
        </ul>
    </nav>
</header>

<div class="hero">Welcome to City Hospital Staff Portal</div>

<div class="container">

<!-- DASHBOARD -->
<div id="dashboard" class="section active">
    <h3>Dashboard</h3>
    <div class="cards">
        <div class="card"><h4><i class="fa-solid fa-file-lines"></i> Total Leaves Submitted</h4><p id="usedLeaves">0</p></div>
        <div class="card" style="background:#fff8e1;"><h4><i class="fa-solid fa-hourglass-half" style="color:#ff9800;"></i> Pending Requests</h4><p id="pendingLeaves">0</p></div>
        <div class="card" style="background:#e8f5e9;"><h4><i class="fa-solid fa-check" style="color:green;"></i> Approved Leaves</h4><p id="approvedLeaves">0</p></div>
        <div class="card" style="background:#ffebee;"><h4><i class="fa-solid fa-ban" style="color:red;"></i> Rejected Leaves</h4><p id="rejectedLeaves">0</p></div>
        <div class="card" style="background:#e3f2fd;"><h4><i class="fa-solid fa-calendar-day" style="color:#2196f3;"></i> Leaves Today</h4><p id="leavesToday">0</p></div>
    </div>
</div>

<!-- APPLY LEAVE -->
<div id="apply" class="section">
    <h3>Apply Leave</h3>
    <form id="leaveForm">
        <input type="text" id="empName" placeholder="Staff Name" required>
        <select id="department" required>
            <option value="">Select Department</option>
            <option>Paediatrics</option>
            <option>Physiotherapy</option>
            <option>Nursing</option>
            <option>Administration</option>
            <option>Pharmacy</option>
        </select>
        <select id="leaveType" required>
            <option value="">Select Leave Type</option>
            <option>Sick Leave</option>
            <option>Casual Leave</option>
            <option>Emergency Leave</option>
            <option>Duty Swap</option>
        </select>
        <input type="date" id="leaveDate" required>
        <textarea id="reason" placeholder="Reason for Leave" required></textarea>
        <button type="submit" class="apply-btn">Apply Leave</button>
    </form>
</div>

<!-- EMPLOYEE VIEW -->
<div id="history" class="section">
    <h3>My Leave Status</h3>
    <div class="filter-group">
        <select id="filterDept">
            <option value="">All Departments</option>
            <option>Paediatrics</option>
            <option>Physiotherapy</option>
            <option>Nursing</option>
            <option>Administration</option>
            <option>Pharmacy</option>
        </select>
        <select id="filterStatus">
            <option value="">All Status</option>
            <option>Pending</option>
            <option>Approved</option>
            <option>Rejected</option>
        </select>
        <button class="apply-btn" onclick="applyFilters()">Filter</button>
    </div>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Department</th>
                <th>Type</th>
                <th>Leave Date</th>
                <th>Status</th>
                <th>Total Leaves</th>
            </tr>
        </thead>
        <tbody id="employeeTable"></tbody>
    </table>
</div>

<!-- MANAGER LOGIN -->
<div id="managerLogin" class="section">
    <div class="login-box">
        <h3>HR / Manager Login</h3>
        <input type="text" id="mgrUser" placeholder="Username">
        <input type="password" id="mgrPass" placeholder="Password">
        <button class="apply-btn" onclick="managerLogin()">Login</button>
    </div>
</div>

<!-- MANAGER PANEL -->
<div id="managerPanel" class="section">
    <h3>HR / Manager Approval</h3>
    <button class="logout" onclick="logoutManager()">Logout</button>
    <table>
        <thead>
            <tr>
                <th>Staff Name</th>
                <th>Department</th>
                <th>Leave Type</th>
                <th>Leave Date</th>
                <th>Reason</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="managerTable"></tbody>
    </table>
</div>

</div>

<footer>
City Hospital | 123 Main Street, City | Phone: +1234567890 | Email: info@cityhospital.com
</footer>

<script>
// --- Navigation ---
function showSection(id){
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    if(id!=="apply") loadTables();
}

// --- Apply Leave ---
document.getElementById("leaveForm").addEventListener("submit", function(e){
    e.preventDefault();
    const leave = {
        name: document.getElementById("empName").value,
        department: document.getElementById("department").value,
        type: document.getElementById("leaveType").value,
        leave_date: document.getElementById("leaveDate").value,
        reason: document.getElementById("reason").value
    };
    fetch('/api/leaves', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify(leave)
    })
    .then(res=>res.json())
    .then(data=>{
        alert(data.message);
        this.reset();
        showSection('history');
    })
    .catch(err=>alert("Error submitting leave."));
});

// --- Load Tables ---
function loadTables(){
    fetch('/api/leaves')
    .then(res=>res.json())
    .then(leaves=>{
        const today = new Date().toISOString().slice(0,10);
        let todayCount=0;
        const staffLeaveCount={};
        const employeeTable=document.getElementById("employeeTable");
        const managerTable=document.getElementById("managerTable");
        employeeTable.innerHTML="";
        managerTable.innerHTML="";
        leaves.forEach(l=>{
            staffLeaveCount[l.name]=(staffLeaveCount[l.name]||0)+1;
            employeeTable.innerHTML += `<tr>
                <td>${l.name}</td><td>${l.department}</td><td>${l.type}</td>
                <td>${l.leave_date}</td><td>${l.status}</td>
                <td>${staffLeaveCount[l.name]}</td></tr>`;
            managerTable.innerHTML += `<tr>
                <td>${l.name}</td><td>${l.department}</td><td>${l.type}</td>
                <td>${l.leave_date}</td><td>${l.reason}</td>
                <td>${l.status}</td>
                <td>${l.status==="Pending"?`
                    <button class="approve" onclick="updateStatus('${l.id}','Approved')">Approve</button>
                    <button class="reject" onclick="updateStatus('${l.id}','Rejected')">Reject</button>`:"-"}</td></tr>`;
            if(today===l.leave_date && l.status==="Approved") todayCount++;
        });
        document.getElementById("leavesToday").innerText = todayCount;
        updateDashboard(leaves);
    })
    .catch(err=>console.log(err));
}

// --- Update Status ---
function updateStatus(id,status){
    fetch(`/api/leaves/${id}`, {
        method:'PUT',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({status})
    })
    .then(res=>res.json())
    .then(data=>{
        alert(data.message);
        loadTables();
    });
}

// --- Dashboard ---
function updateDashboard(leaves){
    document.getElementById("usedLeaves").innerText = leaves.length;
    document.getElementById("pendingLeaves").innerText = leaves.filter(l=>l.status==="Pending").length;
    document.getElementById("approvedLeaves").innerText = leaves.filter(l=>l.status==="Approved").length;
    document.getElementById("rejectedLeaves").innerText = leaves.filter(l=>l.status==="Rejected").length;
}

// --- Manager Login ---
function checkManagerAccess(){
    localStorage.getItem("managerLogged")==="true"?showSection("managerPanel"):showSection("managerLogin");
}
function managerLogin(){
    const user=document.getElementById("mgrUser").value;
    const pass=document.getElementById("mgrPass").value;
    fetch('/api/manager/login',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({username:user,password:pass})
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            localStorage.setItem("managerLogged","true");
            showSection("managerPanel");
        } else alert("Invalid HR credentials");
    });
}
function logoutManager(){
    localStorage.removeItem("managerLogged");
    showSection("dashboard");
}

// --- Filter History ---
function applyFilters(){
    const dept=document.getElementById("filterDept").value;
    const status=document.getElementById("filterStatus").value;
    const rows=document.getElementById("employeeTable").querySelectorAll("tr");
    rows.forEach(row=>{
        let show=true;
        if(dept && row.cells[1].innerText!==dept) show=false;
        if(status && row.cells[4].innerText!==status) show=false;
        row.style.display=show?"":"none";
    });
}

// --- Initial Load ---
window.onload=function(){ loadTables(); };
</script>

</body>
</html>
